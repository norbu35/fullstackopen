const jwt = require('jsonwebtoken');
const key = 'lvzeqi123!!##^$.01155';
/**
 *加密
 * @param {*} res 请求头
 * @param {*} obj 加密数据
 * @return {*} 加密模块
 */
const encryption = function (res: { header: (arg0: string, arg1: any) => void; }, obj: any) {
    const str = jwt.sign(obj, key, {
        expiresIn: (1000 * 60 * 60 * 5)
    });
    // 将加密的数据附带到请求头，方便以后操作Anthorization
    res.header('token', str);
    return str;
}
/**
 * 解密
 * @param {*} str 加密字符串
 * @return {*} 解密模块
 */
const decode = async function (str: string) {
    if (!str) {
        throw new Error("NO TOKEN");
    }
    let strArr = str.split(' ');
    str = strArr.length === 2 ? strArr[1] : strArr[0];
    try {
        const obj = await jwt.verify(str, key);
        return obj;
    } catch {
        throw new Error("TOKEN ERROR");
    }
}

module.exports = {
    encryption,
    decode
}